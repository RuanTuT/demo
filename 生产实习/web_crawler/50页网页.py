import random
import time
import requests
import os

agent_list = [
    "Mozilla/5.0 (Linux; U; Android 2.3.6; en-us; Nexus S Build/GRK39F) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
    "Avant Browser/1.2.789rel1 (http://www.avantbrowser.com)",
    "Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/532.5 (KHTML, like Gecko) Chrome/4.0.249.0 Safari/532.5",
    "Mozilla/5.0 (Windows; U; Windows NT 5.2; en-US) AppleWebKit/532.9 (KHTML, like Gecko) Chrome/5.0.310.0 Safari/532.9",
    "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.7 (KHTML, like Gecko) Chrome/7.0.514.0 Safari/534.7",
    "Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/534.14 (KHTML, like Gecko) Chrome/9.0.601.0 Safari/534.14",
    "Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.14 (KHTML, like Gecko) Chrome/10.0.601.0 Safari/534.14",
    "Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.20 (KHTML, like Gecko) Chrome/11.0.672.2 Safari/534.20",
    "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/534.27 (KHTML, like Gecko) Chrome/12.0.712.0 Safari/534.27",
    "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/13.0.782.24 Safari/535.1",
    "Mozilla/5.0 (Windows NT 6.0) AppleWebKit/535.2 (KHTML, like Gecko) Chrome/15.0.874.120 Safari/535.2",
    "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.7 (KHTML, like Gecko) Chrome/16.0.912.36 Safari/535.7",
    "Mozilla/5.0 (Windows; U; Windows NT 6.0 x64; en-US; rv:1.9pre) Gecko/2008072421 Minefield/3.0.2pre",
    "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.0.10) Gecko/2009042316 Firefox/3.0.10"]
base_url = baseURL = 'https://tieba.baidu.com/f?ie=utf-8&6%E5%88%86%E6%9E%90'
headers = {
    'User-Agent': random.choice(agent_list),
    ##'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36',
    'Referer': 'https://tieba.baidu.com/', 'Connection': 'keep-alive'
}
cookies = {
    'cookie': 'HOSUPPORT=1; HOSUPPORT_BFESS=1; BIDUPSID=613C9C736788697B54D218B3CD1D0902; PSTM=1658075122; UBI=fi_PncwhpxZ%7ETaKAY8OhSzmT4d4d8gz09-UMUsdYJGNYu%7E7N%7Eb1n-6mD-e%7EyYvyAgPJJiQKpAZqXrfZbBUOjQkT1jJ0WzrOekpN-vBbZJu1gsOq%7EbGBHygLCK41138Drlwjbj3a79pQ%7EV1D94omx6zk8rDqBA__; UBI_BFESS=fi_PncwhpxZ%7ETaKAY8OhSzmT4d4d8gz09-UMUsdYJGNYu%7E7N%7Eb1n-6mD-e%7EyYvyAgPJJiQKpAZqXrfZbBUOjQkT1jJ0WzrOekpN-vBbZJu1gsOq%7EbGBHygLCK41138Drlwjbj3a79pQ%7EV1D94omx6zk8rDqBA__; H_WISE_SIDS=219946_234927_219623_234020_240594_216851_213353_214805_219943_213040_230180_204902_230288_241794_241995_242271_238267_110085_227869_236312_243706_243880_244258_243958_232628_244701_244722_244957_245411_240590_246234_242682_234208_247130_247631_247829_247974_248356_236537_248644_248654_248724_245305_247629_247584_249183_107312_248312_249359_245944_249631_248124_249765_249812_249488_249922_249920_249908_249982_250042_246092_250182_250164_250737_250860_250890_250950_249342_251260_247509_251460_248087_251622_248154_246855_250534_251133_251415_249501_252007_251967_252129_252264_252245_248079_250759_251569_249892_252723_245919; BAIDUID=2D9CBCEE6C0524684634C27DD800B8A6:FG=1; H_WISE_SIDS_BFESS=219946_234927_219623_234020_240594_216851_213353_214805_219943_213040_230180_204902_230288_241794_241995_242271_238267_110085_227869_236312_243706_243880_244258_243958_232628_244701_244722_244957_245411_240590_246234_242682_234208_247130_247631_247829_247974_248356_236537_248644_248654_248724_245305_247629_247584_249183_107312_248312_249359_245944_249631_248124_249765_249812_249488_249922_249920_249908_249982_250042_246092_250182_250164_250737_250860_250890_250950_249342_251260_247509_251460_248087_251622_248154_246855_250534_251133_251415_249501_252007_251967_252129_252264_252245_248079_250759_251569_249892_252723_245919; BAIDUID_BFESS=2D9CBCEE6C0524684634C27DD800B8A6:FG=1; __bid_n=18896465ecd1328dd34975; newlogin=1; ZD_ENTRY=google; H_PS_PSSID=36555_38792_38843_38832_38918_38808_38785_38840_38636_26350_22158; BDRCVFR[feWj1Vr5u3D]=I67x6TjHwwYf0; PSINO=2; delPer=0; BAIDU_WISE_UID=wapp_1687936973073_819; Hm_lvt_90056b3f84f90da57dc0f40150f005d5=1688105780; Hm_lpvt_90056b3f84f90da57dc0f40150f005d5=1688105780; ZFY=1VyQzZGO4wC2wZmfna:Bq7ZTTEEIRhbX9Zazpm:BqCt:Bk:C; arialoadData=false; pplogid=89343lU3BYEPTULZ0vxD5OiA%2B7WYm%2B5G9EuPvlGSprsu9twNT5ipXQmnNqOSZA7JSh97WtHWhc9Nucz6q8gvAxW6Ue9VkeL85LFrOvY8XGAhiAjcY8YEuzPKLBg42bD%2Fe6%2F9; pplogid_BFESS=89343lU3BYEPTULZ0vxD5OiA%2B7WYm%2B5G9EuPvlGSprsu9twNT5ipXQmnNqOSZA7JSh97WtHWhc9Nucz6q8gvAxW6Ue9VkeL85LFrOvY8XGAhiAjcY8YEuzPKLBg42bD%2Fe6%2F9; STOKEN=a76a5f00aa07585e4e0c7d4e7a424cc9ec34fdc3fe0d3afa5d9a99caafe098e7; BDUSS=5MbE9ZZVQtdGh6allwbFBUYUg4QjBILVdkZU9aZzh0YkN4c2xIYVlaV3BKY1prRVFBQUFBJCQAAAAAAAAAAAEAAAAyC05Y0P7j5FR1VAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKmYnmSpmJ5kUk; PTOKEN=d47b9c61aae2665666960424d7d2575a; BDUSS_BFESS=5MbE9ZZVQtdGh6allwbFBUYUg4QjBILVdkZU9aZzh0YkN4c2xIYVlaV3BKY1prRVFBQUFBJCQAAAAAAAAAAAEAAAAyC05Y0P7j5FR1VAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKmYnmSpmJ5kUk; STOKEN_BFESS=a76a5f00aa07585e4e0c7d4e7a424cc9ec34fdc3fe0d3afa5d9a99caafe098e7; PTOKEN_BFESS=d47b9c61aae2665666960424d7d2575a; BA_HECTOR=85818l8k8k25850ka5210hah1i9t70o1o; ab_sr=1.0.1_ZjFlOTE2NzVlNzNlOWY3Y2EyN2RiYjE1MGNiMWFjNWRmYzc0YjUxNDUwN2JkNmVkMjA5Yjk5Nzg0M2EzNjAyMjE1MjcyNGQ5NDM5ZDY5ZDQzMDg4OWIzMjNjMTYwNWY5Yjg5MmJkOGNkN2JkNDRmZGI4NzJmY2E3NWQ0ODdlOGQxNzQ3ZGMzYTgwNGM4MGRlYTk1ZDMyZDVhZjU0NzE0NTUzODM3ZjIzMWVmNjcwZWMwZWYzNDg1MThhMWFhYjc2; RT="z=1&dm=baidu.com&si=66ca08c6-208a-487d-89c5-81872009cec0&ss=ljibywv2&sl=l&tt=olm&bcn=https%3A%2F%2Ffclog.baidu.com%2Flog%2Fweirwood%3Ftype%3Dperf&ld=uziq&nu=se94uzb&cl=wmmi&ul=wmmu&hd=wms5"'}

dirname = './百度贴吧/历史吧/'  # 保存⽂件地址
if not os.path.exists(dirname):
    os.makedirs(dirname)
key = '历史'
for i in range(0, 50):
    params = {
        'ie': 'utf-8',
        'kw': key,
        'pn': str(i * 50)
    }
    response = requests.get(base_url, cookies=cookies, headers=headers, params=params)
    with open(dirname + '历史吧第%s页.html' % (i + 1), 'w', encoding='utf-8') as file:
       file.write(response.content.decode('utf-8'))
    time.sleep(random.uniform(0.5, 1))  # 随机等待时间是0.5秒和1秒之间的一个小数
